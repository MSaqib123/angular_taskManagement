<form [formGroup]="form" (ngSubmit)="onSubmit()" class="add-task mb-8 bg-gray-50 p-6 rounded-lg shadow-md">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- Task Title -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Task Title <span class="text-red-500">*</span></label>
      <input formControlName="title"
             class="w-full p-3 mt-1 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500 transition"
             [class.border-red-300]="form.get('title')?.touched && form.get('title')?.invalid"
             [class.border-gray-300]="!form.get('title')?.invalid || !form.get('title')?.touched"
             placeholder="Enter task title...">
      <p *ngIf="form.get('title')?.touched && form.get('title')?.errors?.['required']"
         class="text-red-500 text-xs mt-1">Title is required</p>
    </div>

    <!-- Category -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Category <span class="text-red-500">*</span></label>
      <select formControlName="category"
              class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        <option value="personal">Personal</option>
        <option value="work">Work</option>
        <option value="urgent">Urgent</option>
        <option value="other">Other</option>
      </select>
    </div>

    <!-- Due Date -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Due Date</label>
      <input type="date" formControlName="dueDate"
             class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
    </div>

    <!-- Priority -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Priority <span class="text-red-500">*</span></label>
      <select formControlName="priority"
              class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>
    </div>

    <!-- Recurrence - Conditional Required -->
    <div>
      <label class="block text-sm font-medium text-gray-700">
        Recurrence 
        <span class="text-red-500" *ngIf="!form.get('dueDate')?.value && form.get('recurrence')?.touched && form.get('recurrence')?.invalid">*</span>
      </label>
      <select formControlName="recurrence"
              class="w-full p-3 mt-1 rounded-lg border focus:outline-none focus:ring-2 focus:ring-indigo-500 transition"
              [class.border-red-300]="shouldShowRecurrenceError()"
              [class.border-gray-300]="!shouldShowRecurrenceError()">
        <option value="none">None</option>
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
      </select>
      <p *ngIf="shouldShowRecurrenceError()" class="text-red-500 text-xs mt-1">
        Recurrence is required for ongoing tasks (when no due date is set)
      </p>
    </div>

    <!-- Time Range -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Start Time</label>
        <input type="time" formControlName="startTime"
               class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">End Time</label>
        <input type="time" formControlName="endTime"
               class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500">
      </div>
    </div>
  </div>

  <!-- Submit Button -->
  <button type="submit"
          class="mt-6 w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed"
          [disabled]="form.invalid">
    Add Task
  </button>
</form>